# Story 12: Post-UV Migration Cleanup - Remove Deprecated Code and Organize Documentation

**Story ID:** DICT-012  
**Epic:** UV Migration & Modernization  
**Priority:** High (Technical Debt)  
**Complexity:** Low  
**Estimated Effort:** 25-30 minutes  
**Depends On:** Story 8 (UV Migration) âœ…, Stories 9-11 (Post-UV Enhancements) âœ…

---

## User Story

**As a** developer maintaining the automation-scripts repository,  
**I want** to remove all deprecated pip-based code and outdated documentation,  
**So that** the repository is clean, maintainable, and only contains current UV-based implementation.

**As a** new contributor to the project,  
**I want** clear documentation organization with an index,  
**So that** I can quickly find relevant documentation without confusion between old and new approaches.

---

## Story Context

### Project Evolution

The dictation module has undergone a significant architectural evolution:

**Phase 1: Stories 1-7 (Pip-based, DEPRECATED)**
- Flat module structure in `modules/dictation/`
- Pip-based dependency management via `requirements/` directory
- Manual environment setup via `scripts/setup-dev.sh`
- `.env` configuration files

**Phase 2: Story 8 (UV Migration)**
- Migrated to `src/automation_scripts/dictation/` package structure
- Replaced pip with UV package management
- Consolidated dependencies in `pyproject.toml` + `uv.lock`
- Migrated to TOML-based configuration

**Phase 3: Stories 9-11 (Post-UV Enhancements)**
- Added systemd hotkey service (Story 9)
- Fixed critical SIGTERM hang bug (Story 10)
- Enhanced startup reliability (Story 10.5)
- Improved diagnostics (Story 10.6)
- Updated configuration testing and documentation (Story 11)

**Current State:**
- Working codebase: `src/automation_scripts/dictation/`
- Package management: `pyproject.toml` + `uv.lock`
- Test suite: 112 tests passing, 31% coverage
- Configuration: TOML-based with environment overrides
- **Problem:** Repository contains deprecated artifacts from Phase 1

### Deprecated Artifacts Overview

#### Deprecated Directories (4)

1. **`modules/dictation/`** (312 lines across 6 files)
   - Old flat module structure
   - Replaced by: `src/automation_scripts/dictation/`
   - Status: Has DEPRECATED.md marker
   - Last used: Story 7 (before UV migration)

2. **`requirements/`** (4 files)
   - Old pip requirements management
   - Replaced by: `pyproject.toml` + `uv.lock`
   - Status: Has DEPRECATED.md marker
   - Last used: Story 7

3. **`staging/`** (unused playground scripts)
   - Contains: `borg-backup.sh`, old `dictate.py` experiments
   - Purpose: No longer relevant
   - Status: Has DEPRECATED.md marker
   - Safe to remove: Not referenced by any active code

4. **`htmlcov/`** (pytest-cov generated HTML reports)
   - Generated by: `pytest --cov --cov-report=html`
   - Status: Regenerated on each test run
   - Safe to remove: Not needed in version control

#### Deprecated Documentation Files (8)

1. **`docs/ARCHITECTURE_SUMMARY.md`** (174 lines)
   - Superseded by: `docs/ARCHITECTURE.md` (comprehensive version)
   - Issue: Partial/outdated architecture info
   - Decision: Remove in favor of single authoritative doc

2. **`docs/DICTATION_ARCHITECTURE.md`** (587 lines)
   - Superseded by: `docs/ARCHITECTURE.md` + `docs/architecture/`
   - Issue: Duplicate/conflicting architecture information
   - Decision: Remove to prevent confusion

3. **`docs/current-state.md`** (temporary migration file)
   - Purpose: Tracked migration progress during Story 8
   - Status: Migration complete
   - Decision: Remove (no longer needed)

4. **`docs/SETUP_CHECKLIST.md`** (pip-based setup)
   - References: Old pip installation, manual venv setup
   - Superseded by: `README.md` (UV-based quick start)
   - Issue: Misleading for new users (wrong approach)

5. **`docs/CONFIGURATION_OPTIONS.md`** (.env format)
   - Documents: Old `.env` configuration approach
   - Superseded by: `docs/USER-GUIDE.md` (TOML-based config)
   - Issue: Describes deprecated configuration system

6. **`docs/ENVIRONMENT_SETUP.md`** (manual venv setup)
   - Documents: Manual Python venv setup
   - Superseded by: UV handles all environment management
   - Issue: Unnecessary with UV (auto-managed)

7. **`docs/SYSTEM_PROFILE.md`** (machine-specific)
   - Content: Specific to developer's personal machine
   - Issue: Not general documentation, not portable
   - Decision: Remove (not relevant to other users)

8. **`docs/USER_PREFERENCES.md`** (redundant)
   - Content: Overlaps heavily with `docs/USER-GUIDE.md`
   - Issue: Duplicate information, causes confusion
   - Decision: Consolidate into USER-GUIDE.md (already done)

### Current Valid Documentation (KEEP)

These files are current, UV-based, and actively maintained:

**Root Documentation:**
- `README.md` - Main project documentation (UV-based quick start)
- `CHANGELOG.md` - Version history (will be updated to v0.1.1)

**docs/ Directory:**
- `ARCHITECTURE.md` - Authoritative architecture document
- `DEVELOPMENT.md` - Developer guide (UV-based workflows)
- `USER-GUIDE.md` - End-user documentation
- `TROUBLESHOOTING.md` - Common issues and solutions
- `MIGRATION-TO-UV.md` - UV migration reference

**docs/architecture/ Directory:**
- `dependency-management.md` - UV dependency strategy
- `SYSTEM_DEPS.md` - System-level dependencies

**docs/epics/ Directory:**
- `epic-uv-migration.md` - UV migration epic overview

**docs/bugs/ Directory:**
- `CRITICAL-BUG-DICTATION-SIGTERM.md` - Bug documentation

**docs/stories/ Directory:**
- All story files (stories 1-12) - Will be organized, NOT deleted
- Will add archive markers to distinguish pre-UV vs UV-era

**docs/qa/ Directory:**
- All QA gate files - Will be organized, NOT deleted
- Will add archive markers for DICT-001 through DICT-007

---

## Acceptance Criteria

### Functional Requirements

1. **All deprecated directories are removed**
   - `modules/dictation/` deleted
   - `requirements/` deleted
   - `staging/` deleted
   - `htmlcov/` deleted
   - Git history preserved (files still in history)

2. **All deprecated documentation files are removed**
   - 8 files deleted (listed above)
   - No broken links in remaining documentation
   - References to deprecated docs removed/updated

3. **Documentation index created**
   - `docs/index.md` exists
   - Lists all current documentation with descriptions
   - Organized by category (User Docs, Developer Docs, Architecture, etc.)
   - Links are validated (no 404s)

### Integration Requirements

4. **Story archive documentation updated**
   - `docs/stories/README.md` created/updated
   - Clear section: "Archived Stories (Pre-UV Era)"
   - Stories 1-7 marked as "Deprecated - Pip-based implementation"
   - Stories 8-12 marked as "Current - UV-based implementation"
   - Links to all story files work correctly

5. **QA gate archive documentation updated**
   - `docs/qa/gates/README.md` created/updated
   - Clear section: "Archived QA Gates (Pre-UV Era)"
   - DICT-001 through DICT-007 marked as archived
   - DICT-008 through DICT-012 marked as current
   - Links to all QA gate files work correctly

6. **CHANGELOG.md updated**
   - Version bumped to v0.1.1
   - Section: "v0.1.1 - Post-UV Migration Cleanup"
   - Lists all removed directories/files
   - Documents documentation reorganization
   - Includes validation results (test count)

### Quality Requirements

7. **No breaking changes introduced**
   - All 112 tests pass (pytest baseline)
   - No new test failures
   - No import errors
   - CLI commands work: `uv run dictation-toggle --help`
   - Module import works: `from automation_scripts.dictation import main`

8. **No pip references in active documentation**
   - Current docs don't mention pip installation
   - Current docs reference UV for package management
   - Exception: Archived stories/QA gates (clearly marked)
   - Exception: `docs/MIGRATION-TO-UV.md` (comparison document)

9. **Repository is clean and organized**
   - No unused files in root or key directories
   - Documentation has clear structure via index
   - git status shows clean working tree after changes
   - No large generated files (htmlcov) in repo

---

## Technical Implementation Details

### Deletion Strategy

**Safe Deletion Checklist:**

For each file/directory:
1. âœ“ Verify it has DEPRECATED.md marker OR is documented in this story
2. âœ“ Search codebase for imports/references
3. âœ“ Update any documentation links pointing to it
4. âœ“ Run test suite after deletion
5. âœ“ Commit with descriptive message

**Import Analysis (Pre-Deletion Validation):**

```bash
# Check if deprecated modules are imported anywhere
grep -r "from modules.dictation" --include="*.py" .
grep -r "import modules.dictation" --include="*.py" .

# Check for requirements file references
grep -r "requirements/" --include="*.py" --include="*.sh" --include="*.md" .

# Expected result: Only references in deprecated files themselves
```

### Documentation Index Structure

**docs/index.md** (new file):

```markdown
# Automation Scripts Documentation Index

> **Version:** v0.1.1 (Post-UV Migration)  
> **Last Updated:** [Date]

## Getting Started

- [README.md](../README.md) - Project overview and quick start
- [USER-GUIDE.md](USER-GUIDE.md) - End-user documentation
- [TROUBLESHOOTING.md](TROUBLESHOOTING.md) - Common issues and solutions

## Developer Documentation

- [DEVELOPMENT.md](DEVELOPMENT.md) - Development workflow with UV
- [ARCHITECTURE.md](ARCHITECTURE.md) - System architecture
- [MIGRATION-TO-UV.md](MIGRATION-TO-UV.md) - UV migration reference

## Architecture Deep Dives

- [architecture/dependency-management.md](architecture/dependency-management.md) - Dependency strategy
- [architecture/SYSTEM_DEPS.md](architecture/SYSTEM_DEPS.md) - System dependencies

## Project History

- [CHANGELOG.md](../CHANGELOG.md) - Version history
- [epics/epic-uv-migration.md](epics/epic-uv-migration.md) - UV migration epic
- [stories/README.md](stories/README.md) - Story documentation index
- [qa/gates/README.md](qa/gates/README.md) - QA gate documentation index

## Bug Tracking

- [bugs/CRITICAL-BUG-DICTATION-SIGTERM.md](bugs/CRITICAL-BUG-DICTATION-SIGTERM.md)

## Archived Documentation

> âš ï¸ **Note:** Pre-UV migration stories (DICT-001 through DICT-007) and their QA gates
> describe a deprecated pip-based implementation. They are preserved for historical
> reference but should not be followed for current development.

- See [stories/README.md](stories/README.md) for archived story documentation
- See [qa/gates/README.md](qa/gates/README.md) for archived QA gate documentation
```

### Story Archive Structure

**docs/stories/README.md** (new file):

```markdown
# Story Documentation Index

## Current Stories (UV-Based Implementation)

### Epic: UV Migration & Modernization

| Story | Title | Status | Document |
|-------|-------|--------|----------|
| DICT-008 | UV Migration | âœ… Complete | [story-8-uv-migration.md](story-8-uv-migration.md) |
| DICT-009 | Systemd Hotkey Service | âœ… Complete | [story-9-systemd-hotkey.md](story-9-systemd-hotkey.md) |
| DICT-010 | Fix SIGTERM Hang | âœ… Complete | [story-10-fix-sigterm-hang.md](story-10-fix-sigterm-hang.md) |
| DICT-010.5 | Startup Reliability Fix | âœ… Complete | [story-10.5-startup-fix.md](story-10.5-startup-fix.md) |
| DICT-010.6 | Enhanced Diagnostics | âœ… Complete | [story-10.6-enhanced-diagnostics.md](story-10.6-enhanced-diagnostics.md) |
| DICT-011 | Config Test Documentation | âœ… Complete | [story-11-config-test-docs.md](story-11-config-test-docs.md) |
| DICT-012 | Post-UV Cleanup | ðŸš§ In Progress | [story-12-post-uv-cleanup.md](story-12-post-uv-cleanup.md) |

## Archived Stories (Pre-UV Era - Pip-Based)

> âš ï¸ **DEPRECATED:** The stories below describe a pip-based implementation that has been
> replaced by the UV-based approach (Story 8+). They are preserved for historical reference
> and to understand the project's evolution. **Do not follow these stories for current development.**

### Epic: Initial Dictation Module Implementation (Deprecated)

| Story | Title | Status | Document | Notes |
|-------|-------|--------|----------|-------|
| DICT-001 | Audio Recording | ðŸ—„ï¸ Archived | [story-1-audio-recording.md](story-1-audio-recording.md) | Pip-based, flat module structure |
| DICT-002 | Speech Transcription | ðŸ—„ï¸ Archived | [story-2-speech-transcription.md](story-2-speech-transcription.md) | Pip-based |
| DICT-003 | Text Injection | ðŸ—„ï¸ Archived | [story-3-text-injection.md](story-3-text-injection.md) | Pip-based |
| DICT-004 | Hotkey Wrapper | ðŸ—„ï¸ Archived | [story-4-hotkey-wrapper.md](story-4-hotkey-wrapper.md) | .env config (superseded) |
| DICT-005 | Setup Script | ðŸ—„ï¸ Archived | [story-5-setup-script.md](story-5-setup-script.md) | Pip installation (superseded) |
| DICT-006 | Documentation & Testing | ðŸ—„ï¸ Archived | [story-6-documentation-testing.md](story-6-documentation-testing.md) | Pip-based |
| DICT-006.1 | Fix Test Suite | ðŸ—„ï¸ Archived | [story-6.1-fix-test-suite.md](story-6.1-fix-test-suite.md) | Pip-based |
| DICT-007 | Configuration System | ðŸ—„ï¸ Archived | [story-7-configuration-system.md](story-7-configuration-system.md) | .env config (superseded by TOML) |
| DICT-007 | Implementation Plan | ðŸ—„ï¸ Archived | [story-7-implementation-plan.md](story-7-implementation-plan.md) | .env config planning |

**Migration Cutover:** Story 8 (UV Migration) replaced the entire implementation. All code from Stories 1-7 was rewritten or migrated.

**Preserved For:**
- Understanding original design decisions
- Historical context for architecture evolution
- Reference for migration lessons learned
```

### QA Gate Archive Structure

**docs/qa/gates/README.md** (new file):

```markdown
# QA Gate Documentation Index

## Current QA Gates (UV-Based Implementation)

| Gate ID | Story | Status | Document |
|---------|-------|--------|----------|
| DICT-008 | UV Migration | âœ… PASS | DICT-008-uv-migration.yml |
| DICT-009 | Systemd Hotkey | âœ… PASS | DICT-009-systemd-hotkey.yml |
| DICT-010 | SIGTERM Fix | âœ… PASS | DICT-010-fix-sigterm-hang.yml |
| DICT-010.5 | Startup Fix | âœ… PASS | DICT-010.5-startup-fix.yml |
| DICT-010.6 | Enhanced Diagnostics | âœ… PASS | DICT-010.6-enhanced-diagnostics.yml |
| DICT-011 | Config Test Docs | âœ… PASS | DICT-011-config-test-docs.yml |
| DICT-012 | Post-UV Cleanup | ðŸš§ Pending | DICT-012-post-uv-cleanup.yml |

## Archived QA Gates (Pre-UV Era)

> âš ï¸ **DEPRECATED:** QA gates below validated a pip-based implementation that has been replaced.
> Preserved for historical record only.

| Gate ID | Story | Status | Document | Notes |
|---------|-------|--------|----------|-------|
| DICT-001 | Audio Recording | ðŸ—„ï¸ Archived | DICT-001-audio-recording.yml | Pip-based validation |
| DICT-002 | Speech Transcription | ðŸ—„ï¸ Archived | DICT-002-speech-transcription.yml | Pip-based validation |
| DICT-003 | Text Injection | ðŸ—„ï¸ Archived | DICT-003-text-injection.yml | Pip-based validation |
| DICT-004 | Hotkey Wrapper | ðŸ—„ï¸ Archived | DICT-004-hotkey-wrapper.yml | .env validation |
| DICT-005 | Setup Script | ðŸ—„ï¸ Archived | DICT-005-setup-script.yml | Pip installation validation |
| DICT-006 | Documentation | ðŸ—„ï¸ Archived | DICT-006-documentation-testing.yml | Pip-based testing |
| DICT-007 | Configuration | ðŸ—„ï¸ Archived | DICT-007-configuration-system.yml | .env validation |
```

### CHANGELOG.md Update

```markdown
## [v0.1.1] - 2025-01-[DATE] - Post-UV Migration Cleanup

### ðŸ§¹ Cleanup

**Removed Deprecated Directories:**
- `modules/dictation/` - Old flat module structure (replaced by src/automation_scripts/dictation/)
- `requirements/` - Old pip requirements (replaced by pyproject.toml + uv.lock)
- `staging/` - Unused playground scripts
- `htmlcov/` - Generated HTML coverage reports (not needed in repo)

**Removed Outdated Documentation:**
- `docs/ARCHITECTURE_SUMMARY.md` - Superseded by ARCHITECTURE.md
- `docs/DICTATION_ARCHITECTURE.md` - Duplicate architecture documentation
- `docs/current-state.md` - Temporary migration tracking file
- `docs/SETUP_CHECKLIST.md` - Old pip-based setup (superseded by README.md)
- `docs/CONFIGURATION_OPTIONS.md` - Old .env format (superseded by USER-GUIDE.md)
- `docs/ENVIRONMENT_SETUP.md` - Manual venv setup (UV auto-manages)
- `docs/SYSTEM_PROFILE.md` - Machine-specific, not general documentation
- `docs/USER_PREFERENCES.md` - Redundant with USER-GUIDE.md

### ðŸ“š Documentation

**Added:**
- `docs/index.md` - Complete documentation index and navigation
- `docs/stories/README.md` - Story documentation index with archive markers
- `docs/qa/gates/README.md` - QA gate index with archive markers

**Updated:**
- All documentation now references UV-based workflows exclusively
- Stories 1-7 clearly marked as "Archived (Pre-UV Era)"
- QA gates DICT-001 through DICT-007 marked as archived

### âœ… Validation

**Test Results:**
- Test suite: 112/112 tests passing (100% retention)
- Coverage: 31% (baseline maintained)
- No breaking changes introduced
- All imports working correctly
- CLI commands operational

**Story:** DICT-012 (Post-UV Cleanup)  
**QA Gate:** PASS âœ…
```

---

## Implementation Checklist

### Phase 1: Pre-Deletion Validation (5 minutes)

- [ ] Run full test suite and record baseline
  ```bash
  uv run pytest -v
  # Expected: 112 passed
  ```

- [ ] Verify module imports work
  ```bash
  uv run python -c "from automation_scripts.dictation import main; print('OK')"
  ```

- [ ] Verify CLI works
  ```bash
  uv run dictation-toggle --help
  ```

- [ ] Search for imports of deprecated modules
  ```bash
  grep -r "from modules.dictation" --include="*.py" .
  grep -r "import modules.dictation" --include="*.py" .
  # Should find zero results (or only in deprecated files themselves)
  ```

- [ ] Search for requirements file references
  ```bash
  grep -r "requirements/" --include="*.py" --include="*.sh" --include="*.md" . | grep -v "^docs/stories" | grep -v "^docs/qa"
  # Should find zero results in active code
  ```

### Phase 2: Create Documentation Organization (10 minutes)

- [ ] Create `docs/index.md` with complete documentation structure
  - [ ] Add Getting Started section
  - [ ] Add Developer Documentation section
  - [ ] Add Architecture Deep Dives section
  - [ ] Add Project History section
  - [ ] Add Bug Tracking section
  - [ ] Add Archived Documentation section with warning
  - [ ] Validate all links work

- [ ] Create `docs/stories/README.md`
  - [ ] Add "Current Stories (UV-Based)" section with Stories 8-12
  - [ ] Add "Archived Stories (Pre-UV Era)" section with Stories 1-7
  - [ ] Add deprecation warning at top of archive section
  - [ ] Include table with story ID, title, status, document link
  - [ ] Validate all links work

- [ ] Create `docs/qa/gates/README.md`
  - [ ] Add "Current QA Gates" section with DICT-008 through DICT-012
  - [ ] Add "Archived QA Gates" section with DICT-001 through DICT-007
  - [ ] Add deprecation warning at top of archive section
  - [ ] Include table with gate ID, story, status, document link
  - [ ] Validate all links work

### Phase 3: Delete Deprecated Directories (5 minutes)

- [ ] Delete `modules/dictation/` directory
  ```bash
  rm -rf modules/dictation/
  ```

- [ ] Delete `requirements/` directory
  ```bash
  rm -rf requirements/
  ```

- [ ] Delete `staging/` directory
  ```bash
  rm -rf staging/
  ```

- [ ] Delete `htmlcov/` directory
  ```bash
  rm -rf htmlcov/
  ```

- [ ] Verify git status shows deletions correctly
  ```bash
  git status
  ```

### Phase 4: Delete Deprecated Documentation (3 minutes)

- [ ] Delete `docs/ARCHITECTURE_SUMMARY.md`
- [ ] Delete `docs/DICTATION_ARCHITECTURE.md`
- [ ] Delete `docs/current-state.md`
- [ ] Delete `docs/SETUP_CHECKLIST.md`
- [ ] Delete `docs/CONFIGURATION_OPTIONS.md`
- [ ] Delete `docs/ENVIRONMENT_SETUP.md`
- [ ] Delete `docs/SYSTEM_PROFILE.md`
- [ ] Delete `docs/USER_PREFERENCES.md`

### Phase 5: Update Documentation Links (2 minutes)

- [ ] Search for broken links to deleted files
  ```bash
  # Search in current (non-archived) docs
  grep -r "ARCHITECTURE_SUMMARY.md" docs/*.md README.md
  grep -r "DICTATION_ARCHITECTURE.md" docs/*.md README.md
  grep -r "SETUP_CHECKLIST.md" docs/*.md README.md
  grep -r "CONFIGURATION_OPTIONS.md" docs/*.md README.md
  # etc. for each deleted file
  ```

- [ ] Update any broken links to point to current documentation
  - ARCHITECTURE_SUMMARY.md â†’ ARCHITECTURE.md
  - DICTATION_ARCHITECTURE.md â†’ ARCHITECTURE.md or architecture/
  - SETUP_CHECKLIST.md â†’ README.md (quick start section)
  - CONFIGURATION_OPTIONS.md â†’ USER-GUIDE.md (configuration section)
  - etc.

### Phase 6: Update CHANGELOG.md (2 minutes)

- [ ] Add v0.1.1 section at top of CHANGELOG.md
- [ ] List all removed directories under "Removed Deprecated Directories"
- [ ] List all removed files under "Removed Outdated Documentation"
- [ ] Add "Documentation" subsection listing new index files
- [ ] Add "Validation" subsection with test results
- [ ] Include story and QA gate references

### Phase 7: Post-Deletion Validation (3 minutes)

- [ ] Run full test suite again
  ```bash
  uv run pytest -v
  # Expected: 112 passed (same as baseline)
  ```

- [ ] Verify module imports still work
  ```bash
  uv run python -c "from automation_scripts.dictation import main; print('OK')"
  ```

- [ ] Verify CLI still works
  ```bash
  uv run dictation-toggle --help
  ```

- [ ] Check for pip references in active docs (excluding archived)
  ```bash
  grep -r "pip install" docs/*.md README.md | grep -v "MIGRATION-TO-UV"
  # Should find zero results
  ```

- [ ] Verify documentation links work
  ```bash
  # Spot check key links from docs/index.md
  # Verify no 404s
  ```

### Phase 8: Commit and Document (2 minutes)

- [ ] Stage all changes
  ```bash
  git add -A
  ```

- [ ] Commit with descriptive message
  ```bash
  git commit -m "DICT-012: Post-UV migration cleanup

  Removed deprecated directories:
  - modules/dictation/ (old flat structure)
  - requirements/ (pip requirements)
  - staging/ (unused scripts)
  - htmlcov/ (generated reports)

  Removed outdated documentation:
  - 8 files superseded by current UV-based docs

  Added documentation organization:
  - docs/index.md (complete doc index)
  - docs/stories/README.md (story archive)
  - docs/qa/gates/README.md (QA gate archive)

  Updated CHANGELOG.md to v0.1.1

  Validation: All 112 tests passing, no breaking changes"
  ```

- [ ] Create QA gate document (next phase)

---

## Testing Strategy

### Validation Tests

**Pre-Deletion Baseline:**
```bash
# Capture baseline test results
uv run pytest -v --tb=short > /tmp/baseline-tests.txt 2>&1

# Count passing tests
grep "passed" /tmp/baseline-tests.txt
# Expected: 112 passed
```

**Post-Deletion Validation:**
```bash
# Run tests after deletions
uv run pytest -v --tb=short > /tmp/post-cleanup-tests.txt 2>&1

# Compare results
diff /tmp/baseline-tests.txt /tmp/post-cleanup-tests.txt
# Expected: No differences in test results (only timestamps may differ)

# Verify pass count unchanged
grep "passed" /tmp/post-cleanup-tests.txt
# Expected: 112 passed (same as baseline)
```

**Import Validation:**
```bash
# Test core module imports
uv run python -c "
from automation_scripts.dictation import main
from automation_scripts.dictation.dictate import DictationRecorder
from automation_scripts.dictation.config import DictationConfig
print('All imports successful')
"
# Expected: "All imports successful"
```

**CLI Validation:**
```bash
# Test CLI commands
uv run dictation-toggle --help
uv run dictation-toggle --version
# Expected: Help and version output (no errors)
```

**Documentation Link Check:**
```bash
# Check for broken links in documentation
# (Can use markdown-link-check or manual spot checking)

# Spot check critical links from docs/index.md
cat docs/index.md | grep -o '\[.*\](.*)' | sed 's/.*(\(.*\))/\1/' | while read link; do
  if [ ! -f "$link" ] && [ ! -f "docs/$link" ]; then
    echo "Broken link: $link"
  fi
done
# Expected: No broken links
```

### Manual Tests

1. **Documentation Navigation Test**
   - Open `docs/index.md` in browser or markdown viewer
   - Click through all major documentation links
   - Verify all links work (no 404s)
   - Verify archive sections have clear warnings

2. **Module Functionality Test**
   ```bash
   # Test that dictation module still works end-to-end
   # (This is optional - covered by test suite)
   uv run dictation-toggle --test-audio
   # Expected: Audio test passes
   ```

3. **Git History Test**
   ```bash
   # Verify deleted files are still in git history
   git log --all --full-history -- modules/dictation/dictate.py
   # Expected: Shows commit history (files not lost)
   ```

---

## Definition of Done

- âœ… All 4 deprecated directories removed from working tree
- âœ… All 8 outdated documentation files removed from working tree
- âœ… `docs/index.md` exists with complete documentation structure
- âœ… `docs/stories/README.md` exists with clear archive markers
- âœ… `docs/qa/gates/README.md` exists with clear archive markers
- âœ… `CHANGELOG.md` updated to v0.1.1 with cleanup details
- âœ… All 112 tests passing (no regressions)
- âœ… Module imports work correctly
- âœ… CLI commands work correctly
- âœ… No pip references in active documentation
- âœ… Documentation links validated (no broken links)
- âœ… Git commit created with descriptive message
- âœ… QA gate document created and PASS status achieved

---

## Success Metrics

- **Test Retention:** 112/112 tests passing (100%)
- **Import Success:** All module imports work
- **CLI Success:** All CLI commands operational
- **Documentation Quality:** Complete index, clear organization, no broken links
- **Repository Cleanliness:** 4 directories + 8 files removed, no orphaned artifacts
- **Time to Complete:** â‰¤30 minutes

---

## Technical Notes

### Why These Files Are Safe to Delete

**`modules/dictation/`:**
- No active code imports from this directory
- Replaced entirely by `src/automation_scripts/dictation/`
- Has DEPRECATED.md marker since Story 8
- All functionality migrated and tested in Story 8

**`requirements/`:**
- No active scripts use pip requirements files
- Replaced by `pyproject.toml` (Poetry/UV format)
- `uv.lock` provides exact dependency locking
- All dependencies migrated and validated in Story 8

**`staging/`:**
- Contains experimental/playground scripts
- Not referenced by any active code or documentation
- Not part of any workflow
- No dependencies on these files

**`htmlcov/`:**
- Generated output from `pytest --cov --cov-report=html`
- Regenerated on each test run
- Large files (not suitable for version control)
- Standard practice to .gitignore (should have been ignored from start)

### Git History Preservation

Even after deletion, all files remain accessible in git history:

```bash
# View deleted file contents
git show HEAD~1:modules/dictation/dictate.py

# View full history of deleted file
git log --all --full-history -- modules/dictation/dictate.py

# Restore a deleted file if needed (emergency)
git checkout HEAD~1 -- modules/dictation/dictate.py
```

### Documentation Migration Map

| Old File | Replacement | Migration Path |
|----------|-------------|----------------|
| ARCHITECTURE_SUMMARY.md | ARCHITECTURE.md | Content consolidated |
| DICTATION_ARCHITECTURE.md | ARCHITECTURE.md + architecture/ | Split and reorganized |
| SETUP_CHECKLIST.md | README.md (Quick Start) | UV-based quick start |
| CONFIGURATION_OPTIONS.md | USER-GUIDE.md (Configuration) | TOML examples added |
| ENVIRONMENT_SETUP.md | UV auto-management | No manual setup needed |
| USER_PREFERENCES.md | USER-GUIDE.md | Consolidated |
| SYSTEM_PROFILE.md | N/A (removed) | Machine-specific, not general |
| current-state.md | N/A (removed) | Temporary migration file |

### Rollback Plan

If issues arise after cleanup:

```bash
# Emergency rollback (restore everything)
git revert HEAD

# Selective restoration (if only one file needed)
git checkout HEAD~1 -- path/to/file.md

# Check what was deleted in this commit
git diff HEAD~1 HEAD --name-status
```

---

## Risk Assessment

### Risks

1. **Broken documentation links**
   - **Probability:** Low
   - **Impact:** Medium (user confusion)
   - **Mitigation:** Pre-deletion link scanning, post-deletion validation
   - **Fallback:** Broken links easy to identify and fix

2. **Accidental deletion of required file**
   - **Probability:** Very Low
   - **Impact:** High (functionality broken)
   - **Mitigation:** Pre-deletion import checks, test suite validation
   - **Fallback:** Git revert restores everything immediately

3. **Test failures after deletion**
   - **Probability:** Very Low
   - **Impact:** High (indicates unexpected dependency)
   - **Mitigation:** Pre/post test suite comparison
   - **Fallback:** Git revert, investigate dependency

4. **Users following archived stories**
   - **Probability:** Medium (new contributors)
   - **Impact:** Medium (wasted time, confusion)
   - **Mitigation:** Clear archive warnings, documentation index
   - **Fallback:** Documentation clarification

### Risk Summary

**Overall Risk Level:** LOW

**Mitigation Strategy:**
- Comprehensive pre-deletion validation
- Test suite as safety net (112 tests)
- Git history preservation (nothing truly lost)
- Clear documentation warnings
- Simple rollback procedure (single git revert)

**Confidence Level:** Very High (95%)
- All deleted items clearly identified as deprecated
- No active code depends on deleted items
- Test suite provides regression detection
- Changes are purely organizational (no logic changes)

---

## Dependencies

### Prerequisites

- âœ… Story 8 (UV Migration) complete
- âœ… Story 9 (Systemd Hotkey) complete
- âœ… Story 10 (SIGTERM Fix) complete
- âœ… Story 10.5 (Startup Fix) complete
- âœ… Story 10.6 (Enhanced Diagnostics) complete
- âœ… Story 11 (Config Test Docs) complete

### Blocking Dependencies

None - This story has no blockers.

### Blocked Stories

None - This story doesn't block any future work. It's a cleanup task.

---

## Future Enhancements

### Additional Cleanup (Future Stories)

1. **Add .gitignore for htmlcov/**
   - Prevent future HTML coverage reports from being committed
   - Add entry: `htmlcov/` to `.gitignore`

2. **Archive Old Stories to Subdirectory**
   - Move Stories 1-7 to `docs/stories/archived/pre-uv/`
   - Keep README.md index pointing to archived location
   - Makes active story directory cleaner

3. **Create Documentation Build Process**
   - Use mkdocs or similar to build static documentation site
   - Automatically validate all internal links
   - Generate table of contents

4. **Automated Link Checking**
   - Add pre-commit hook or CI check
   - Use `markdown-link-check` or similar tool
   - Prevent broken links from being committed

---

## Related Documentation

**Current Documentation:**
- `README.md` - Project overview
- `docs/ARCHITECTURE.md` - System architecture
- `docs/DEVELOPMENT.md` - Development guide
- `docs/USER-GUIDE.md` - User documentation

**Story Documentation:**
- Story 8: `docs/stories/story-8-uv-migration.md` - UV migration
- Story 11: `docs/stories/story-11-config-test-docs.md` - Documentation updates

**Epic Documentation:**
- `docs/epics/epic-uv-migration.md` - UV migration epic overview

---

**Story Status:** Ready for Implementation  
**Prerequisites:** All (Stories 8-11 complete) âœ…  
**Blocks:** None  
**Estimated Time:** 25-30 minutes  
**Risk Level:** LOW  
**Confidence:** 95%

---

## Implementation Record

### Implementation Date
_To be completed during implementation_

### Implementer
_To be completed during implementation_

### Actual Time Spent
_To be completed during implementation_

### Deviations from Plan
_To be completed during implementation_

### Validation Results
_To be completed during implementation_

**Baseline Test Results:**
```
Tests passed: [baseline]
Coverage: [baseline]
```

**Post-Cleanup Test Results:**
```
Tests passed: [post-cleanup]
Coverage: [post-cleanup]
Difference: [comparison]
```

### Lessons Learned
_To be completed during implementation_

---

## QA Review

### QA Date
_To be completed after implementation_

### Reviewer
_To be completed after implementation_

### QA Status
_To be determined: PASS / FAIL / CONCERNS_

### QA Notes
_To be completed after implementation_

---

**Document Version:** 1.0  
**Created:** 2025-01-28  
**Last Updated:** 2025-01-28  
**Status:** Ready for Implementation

